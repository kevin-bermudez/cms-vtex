

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      CMSVtex_custom_elements.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Braintree SDK Client Reference
    </h3>

    

    <h3>Modules</h3><ul><li id="custom_elements-nav"><a href="module-custom_elements.html">custom_elements</a><ul class='methods'><li data-type="method" id="custom_elements-add-nav"><a href="module-custom_elements.html#~add">add</a></li><li data-type="method" id="custom_elements-delete_object_coleccion-nav"><a href="module-custom_elements.html#~delete_object_coleccion">delete_object_coleccion</a></li><li data-type="method" id="custom_elements-delete_object_html-nav"><a href="module-custom_elements.html#~delete_object_html">delete_object_html</a></li><li data-type="method" id="custom_elements-get-nav"><a href="module-custom_elements.html#~get">get</a></li><li data-type="method" id="custom_elements-get_info_instance-nav"><a href="module-custom_elements.html#~get_info_instance">get_info_instance</a></li><li data-type="method" id="custom_elements-save_object_coleccion-nav"><a href="module-custom_elements.html#~save_object_coleccion">save_object_coleccion</a></li><li data-type="method" id="custom_elements-save_object_html-nav"><a href="module-custom_elements.html#~save_object_html">save_object_html</a></li><li data-type="method" id="custom_elements-update-nav"><a href="module-custom_elements.html#~update">update</a></li><li data-type="method" id="custom_elements-update-nav"><a href="module-custom_elements.html#~update">update</a></li></ul></li><li id="file-nav"><a href="module-file.html">file</a><ul class='methods'><li data-type="method" id="file-delete-nav"><a href="module-file.html#~delete">delete</a></li><li data-type="method" id="file-file_exist-nav"><a href="module-file.html#~file_exist">file_exist</a></li><li data-type="method" id="file-get_file-nav"><a href="module-file.html#~get_file">get_file</a></li><li data-type="method" id="file-get_list-nav"><a href="module-file.html#~get_list">get_list</a></li><li data-type="method" id="file-update-nav"><a href="module-file.html#~update">update</a></li><li data-type="method" id="file-upload-nav"><a href="module-file.html#~upload">upload</a></li></ul></li><li id="folder-nav"><a href="module-folder.html">folder</a><ul class='methods'><li data-type="method" id="folder-delete-nav"><a href="module-folder.html#~delete">delete</a></li><li data-type="method" id="folder-get-nav"><a href="module-folder.html#~get">get</a></li><li data-type="method" id="folder-save-nav"><a href="module-folder.html#~save">save</a></li></ul></li><li id="layout-nav"><a href="module-layout.html">layout</a><ul class='methods'><li data-type="method" id="layout-add_control-nav"><a href="module-layout.html#~add_control">add_control</a></li><li data-type="method" id="layout-delete-nav"><a href="module-layout.html#~delete">delete</a></li><li data-type="method" id="layout-delete_control-nav"><a href="module-layout.html#~delete_control">delete_control</a></li><li data-type="method" id="layout-delete_object-nav"><a href="module-layout.html#~delete_object">delete_object</a></li><li data-type="method" id="layout-delete_object_coleccion-nav"><a href="module-layout.html#~delete_object_coleccion">delete_object_coleccion</a></li><li data-type="method" id="layout-get-nav"><a href="module-layout.html#~get">get</a></li><li data-type="method" id="layout-get_list_objects-nav"><a href="module-layout.html#~get_list_objects">get_list_objects</a></li><li data-type="method" id="layout-rename_control-nav"><a href="module-layout.html#~rename_control">rename_control</a></li><li data-type="method" id="layout-save-nav"><a href="module-layout.html#~save">save</a></li><li data-type="method" id="layout-save_object-nav"><a href="module-layout.html#~save_object">save_object</a></li><li data-type="method" id="layout-save_object_coleccion-nav"><a href="module-layout.html#~save_object_coleccion">save_object_coleccion</a></li><li data-type="method" id="layout-update_control_coleccion-nav"><a href="module-layout.html#~update_control_coleccion">update_control_coleccion</a></li></ul></li><li id="login-nav"><a href="module-login.html">login</a><ul class='methods'><li data-type="method" id="login-is_logged-nav"><a href="module-login.html#~is_logged">is_logged</a></li></ul></li><li id="template-nav"><a href="module-template.html">template</a><ul class='methods'><li data-type="method" id="template-add_shelf_template-nav"><a href="module-template.html#~add_shelf_template">add_shelf_template</a></li><li data-type="method" id="template-add_sub_template-nav"><a href="module-template.html#~add_sub_template">add_sub_template</a></li><li data-type="method" id="template-add_template-nav"><a href="module-template.html#~add_template">add_template</a></li><li data-type="method" id="template-delete-nav"><a href="module-template.html#~delete">delete</a></li><li data-type="method" id="template-get-nav"><a href="module-template.html#~get">get</a></li><li data-type="method" id="template-get_shelf_templates-nav"><a href="module-template.html#~get_shelf_templates">get_shelf_templates</a></li><li data-type="method" id="template-get_sub_templates-nav"><a href="module-template.html#~get_sub_templates">get_sub_templates</a></li><li data-type="method" id="template-get_template-nav"><a href="module-template.html#~get_template">get_template</a></li><li data-type="method" id="template-update_shelf_template-nav"><a href="module-template.html#~update_shelf_template">update_shelf_template</a></li><li data-type="method" id="template-update_sub_template-nav"><a href="module-template.html#~update_sub_template">update_sub_template</a></li><li data-type="method" id="template-update_template-nav"><a href="module-template.html#~update_template">update_template</a></li></ul></li><li id="website-nav"><a href="module-website.html">website</a><ul class='methods'><li data-type="method" id="website-get-nav"><a href="module-website.html#~get">get</a></li><li data-type="method" id="website-get_website_by_name-nav"><a href="module-website.html#~get_website_by_name">get_website_by_name</a></li></ul></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        CMSVtex_custom_elements.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>//Dependencias
const request = require('sync-request');
const cheerio = require('cheerio');
const querystring = require('querystring');
const CMSVtex_layout = require('./CMSVtex_layout');
//var http = require('http');
const fs = require('fs');
const path = require('path');

/**
 * Custom Elements.
 * @module custom_elements
 * @since 1.0.0
 * @desc Este módulo es util para manipular los custom elements del CMS de vtex incluidos también los objetos de los mismos */
module.exports = function( CMSVtex_general ){
	cms_vtex_custom_elements = exports;
	cms_vtex_custom_elements.get_list_objects = ( instance_type,instance_id ) => {
		//si es HTML
		if(instance_type == 'html'){
			uri_def = CMSVtex_general.url_base + '/admin/a/PortalManagement/GetFormHtmlConfig?viewInstanceId=' + instance_id
		}
		else{
			uri_def = CMSVtex_general.url_base + '/admin/a/PortalManagement/GetFormShelfConfig?viewInstanceId=' + instance_id
		}
		data = {
			isCustomViewPart : 'True'
		}
		let response_sync = request('POST',uri_def,{
				headers : {
					'Cookie' : CMSVtex_general.cookie_vtex,
					'Content-Type' : "application/x-www-form-urlencoded; charset=UTF-8"
				},
				body : querystring.stringify(data)
			})

		let body = response_sync.body.toString();
		//console.log(body)
		return CMSVtex_general.get_content_object( body,instance_type );
	}

	/**
	 * @method get
	 * @desc Obtiene una lista de los custom elements creados en el CMS de Vtex
	 * @param {int} [quantity_elements_us] Cuantos custom elements se quieren recibir como respuesta.
	 * @param {Boolean} [width_content] Si se quieren obtener los objectos de cada custom element.
	 * @return {Object[]} Con toda la información de los custom elements incluidos los objetos de los mismos si así se requiere.
	 */
	cms_vtex_custom_elements.get = ( quantity_elements_us,width_content ) => {
		let uri_def = CMSVtex_general.url_base + 'admin/a/PortalManagement/HandleCustomViewPartList/?siteId=';

		let data = {
			page : 1,
			rp : (quantity_elements_us) ? quantity_elements_us : 200000000,
			sortname : "Id",
		}

		var response_sync = request('POST', uri_def,{
			headers : {
				'Cookie' : CMSVtex_general.cookie_vtex,
				'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8'
			},
			body : querystring.stringify(data)
		} ,
		);

		let response_vtex = JSON.parse(response_sync.body.toString()).rows,
			response_vtex_length = response_vtex.length,
			var_return = [];

		for(let index = 0;index &lt; response_vtex_length;index++){
			var_return.push({
				view_part_id : response_vtex[index].id,
				custom_view_part_id : response_vtex[index].cell[1],
				name : response_vtex[index].cell[2],
				tag : response_vtex[index].cell[3],
				type : response_vtex[index].cell[4].toLowerCase()
			})

			if(width_content){
				//console.log(response_vtex[index].cell[4])
				//console.log(response_vtex[index].cell[2],response_vtex[index].cell[4])
				//let type_instance = response_vtex[index].cell[4];
				//console.log('el tipo lo trae como ',type_instance)
				var_return[var_return.length - 1].objects = cms_vtex_custom_elements.get_list_objects( response_vtex[index].cell[4],response_vtex[index].cell[1] );
			}
		}
		
		return var_return;

	}

	/**
	 * @method get_info_instance
	 * @desc Devuelve la información básica de un custom element sin incluir sus objetos
	 * @param {string} instance_id Identificador devulto por Vtex.
	 * @param {string} view_part_id Segundo identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {Boolean} coleccion Se pasa como true cuando el tipo de custom element del que se quiere obtener la información es Colección.
	 * @return {Object} Con toda la información básica del custom element.
	 */
	cms_vtex_custom_elements.get_info_instance = ( instance_id,view_part_id,coleccion ) => {
		let uri_def = CMSVtex_general.url_base + '/admin/a/PortalManagement/AddCustomViewPart?siteId=&amp;customViewPartId=' + instance_id + '&amp;viewPartId=' + view_part_id
		//console.log(uri_def)
		let response_sync = request('GET',uri_def,{
				headers : {
					'Cookie' : CMSVtex_general.cookie_vtex,
					'Content-Type' : "application/x-www-form-urlencoded; charset=UTF-8"
				}
			})

		let body = response_sync.body.toString();
		let $ = cheerio.load(body);
		//console.log(body)

		var_return = {
			name : $('#customViewPartNameOut').attr('value').trim(),
			tag_name : $('#customViewPartTagNameOut').attr('value').trim(),
			instance_id,
			view_part_id
		}

		if(coleccion){
			let uri_def = CMSVtex_general.url_base + 'admin/a/PortalManagement/GetFormShelfConfig?viewInstanceId=18b70f99-9ad4-40fa-a2f1-5646dbe5a023'
			//console.log(uri_def)
			let response_sync = request('POST',uri_def,{
					headers : {
						'Cookie' : CMSVtex_general.cookie_vtex,
						'Content-Type' : "application/x-www-form-urlencoded; charset=UTF-8"
					},
					body : querystring.stringify({
						isCustomViewPart : true
					})
				})

			let body = response_sync.body.toString();
			let $ = cheerio.load(body);

			col_var_return = {
				layout : $('#layout').children("option:selected").attr('value'),
				colCount : $('#colCount').attr('value'),
				itemCount : $('#itemCount').attr('value'),
				showUnavailable : (typeof $('#showUnavailable').attr('checked') != 'undefined'),
				isRandomize : (typeof $('#isRandomize').attr('checked') != 'undefined'),
				isPaged : (typeof $('#isPaged').attr('checked') != 'undefined'),
			}

			

			var_return = Object.assign( var_return,col_var_return );
		}

		return var_return;
	}

	cms_vtex_custom_elements.generate_content_list_coleccion = ( actual_objects,instance_id ) => {
		actual_objects_length = actual_objects.length,
		shelf_content_list = []
		//console.log('generate list',actual_objects)
		for(let index = 0;index &lt; actual_objects_length;index++){
			shelf_content_list.push({
				ViewPartInstanceId : instance_id,
				Indice : index,
				ContentName : CMSVtex_general.get_html_entities(actual_objects[index].name),
				Partner : actual_objects[index].partner,
				Campaign : actual_objects[index].campaign,
				Category : actual_objects[index].category,
				Brand : actual_objects[index].brand,
				Source : actual_objects[index].source,
				Keyword : actual_objects[index].keyword,
				Periods : actual_objects[index].period,
				Active : (actual_objects[index].active),
				ProductCluster : (actual_objects[index].additional.ProductCluster) ? actual_objects[index].additional.ProductCluster :'',
				SearchQueryString : actual_objects[index].additional.queryString,
				Id : actual_objects[index].id
			})
		}

		return shelf_content_list;
	}

	cms_vtex_custom_elements.save = ( instance_type,info_new,view_part_id,instance_id ) => {
		//instance_id = ''
		let data = {
			viewPartInstanceId : (instance_id) ? instance_id : '',
			//totalRows : 0,
			isCustomViewPart : 'True',
			customViewPartName : info_new.customViewPartName,
			customViewPartTagName : info_new.customViewPartTagName,
			customViewPartTypeId : CMSVtex_general.get_type_control( false,instance_type ),
			customViewPartisPersisted : (view_part_id) ? 'True' : 'False',
			categoryIdSelected : (info_new.categoryIdSelected) ? info_new.categoryIdSelected : '',
			categoryNameSelected : (info_new.categoryNameSelected) ? info_new.categoryNameSelected : ''
		}

		if(instance_type == 'html'){
			data.htmlContentList = (info_new.htmlContentList) ? JSON.stringify(info_new.htmlContentList) : ""
			data.htmlContentListInicial = (info_new.htmlContentListInicial) ? JSON.stringify(info_new.htmlContentListInicial) : ""
			data.FormHtmlConfigId = (instance_id) ? instance_id : ''
		}
		else{
			data.layout = info_new.layout
			data.colCount = info_new.colCount
			data.itemCount = info_new.itemCount
			data.showUnavailable = (info_new.showUnavailable) ? info_new.showUnavailable : false
			data.isRandomize = (info_new.isRandomize) ? info_new.isRandomize : false
			data.isPaged = (info_new.isPaged) ? info_new.isPaged : false
			data.contentList = (info_new.contentList) ? info_new.contentList : '[]'
			data.contentListInicial = (info_new.contentListInicial) ? info_new.contentListInicial : ''
			data.FormShelfConfigId = (instance_id) ? instance_id : ''
			//data.customViewpartId = ''
		}

		if(view_part_id){
			data.customViewPartId = instance_id;
			data.viewPartId = view_part_id;
		}

		//console.log(data)

		let uri_def = CMSVtex_general.url_base + 'admin/a/PortalManagement/'
		if(instance_type == 'html'){
			uri_def += 'SaveHtmlConfig'
		}
		else{
			uri_def += 'SaveControlConfig'
		}
		

		let sync_response = request('POST',uri_def,{
			headers : {
				'Cookie' : CMSVtex_general.cookie_vtex,
				'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8'
			},
			body : querystring.stringify(data)
		})

		let body = sync_response.body.toString();

		if(body != ''){
			$ = cheerio.load( body );
			return $('title').text()
		}
		else{
			return true;
		}
	}

	/**
	 * @method add
	 * @desc Agrega un custom element.
	 * @param {string} instance_type Tipo de custom element: html o coleccion
	 * @param {Object} info_new Con la información de configuración para el custom element según corresponda.
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.add = ( instance_type,info_new ) => {
		return cms_vtex_custom_elements.save( instance_type,info_new );
	}

	/**
	 * @method update
	 * @desc Actualiza un custom element creado previamente en el CMS.
	 * @param {string} instance_type Tipo de custom element: html o coleccion
	 * @param {Object} info_new Con la información de la nueva configuración para el custom element según corresponda.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} instance_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.update = ( instance_type,info_new,view_part_id,instance_id ) => {
		return cms_vtex_custom_elements.save( instance_type,info_new,view_part_id,instance_id );
	}

	/**
	 * @method update
	 * @desc Elimina un custom element creado previamente en el CMS.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} custom_view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @return {Boolean} True si se completa la opción correctamente o de lo contrario false.
	 */
	cms_vtex_custom_elements.delete = ( view_part_id,custom_view_part_id ) => {
		let data = {
			textConfirm : 'yes',
			customViewPartId : custom_view_part_id,
			viewPartId : view_part_id
		}

		let uri_def = CMSVtex_general.url_base + 'admin/a/PortalManagement/DeleteCustomViewPart';

		let response_sync = request('POST',uri_def,{
			headers : {
				'Cookie' : CMSVtex_general.cookie_vtex,
				'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8'
			},
			body : querystring.stringify(data)
		} ,
		);

		let body = response_sync.body.toString();

		return (body == '');
	}

	/**
	 * @method save_object_html
	 * @desc Crea o actualiza un objeto de tipo html para un custom element determinado.
	 * @param {string} instance_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} info_new Configuración del nuevo objeto html.
	 * @param {string} [id_object] Identificador del objeto en caso de que la acción requerida sea una actualización
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.save_object_html = ( instance_id,view_part_id,info_new,id_object ) => {
		list_contents_add_us = (JSON.stringify(info_new).substr(0,1) == '{') ? new Array(info_new) : info_new
		list_contents_add_def = [];

		list_contents_add_us.forEach( ( new_content,index )=> {
			list_contents_add_def.push({
				ViewPartInstanceId : instance_id,
				Indice : index,
				ContentName : new_content.ContentName,
				Partner : (new_content.partner) ? new_content.partner : '',
				Campaign : (new_content.campaign) ? new_content.campaign : '',
				Category : (new_content.category) ? new_content.category : '',
				Brand : (new_content.brand) ? new_content.brand : '',
				Source : (new_content.source) ? new_content.source : '',
				Keyword : (new_content.keyword) ? new_content.keyword : '',
				Periods : (new_content.periods) ? new_content.periods : [],
				Active : (new_content.active) ? 'True' : 'False',
				FileName : '',
				Html : (new_content.Html) ? new_content.Html : ''
			} )
		} )

		if(id_object){
			let actual_objects = cms_vtex_custom_elements.get_list_objects( 'html',instance_id );

			let index_object_actual = actual_objects.map( (actual_object) => {
				return actual_object.id
			}).indexOf( id_object )
			console.log('object actual',actual_objects[index_object_actual])
			initial_content = []

			initial_content.push({
				ViewPartInstanceId : instance_id,
				Indice : index_object_actual,
				ContentName :  actual_objects[index_object_actual].name,
				Partner :  actual_objects[index_object_actual].partner,
				Campaign :  actual_objects[index_object_actual].campaign,
				Category :  actual_objects[index_object_actual].category,
				Brand :  actual_objects[index_object_actual].brand,
				Source :  actual_objects[index_object_actual].source,
				Keyword :  actual_objects[index_object_actual].keyword,
				Periods :  actual_objects[index_object_actual].period,
				Active : actual_objects[index_object_actual].active,
				FileName : '',
				Html :  actual_objects[index_object_actual].additional,
				Id : actual_objects[index_object_actual].id
			})

			list_contents_add_def[0].Indice = index_object_actual
			list_contents_add_def[0].Id = actual_objects[index_object_actual].id
		}

		let info_instance = cms_vtex_custom_elements.get_info_instance( instance_id,view_part_id );
		
		return cms_vtex_custom_elements.save('html',{
			customViewPartName : info_instance.name,
			customViewPartTagName : info_instance.tag_name,
			htmlContentList : list_contents_add_def,
			htmlContentListInicial : (typeof initial_content != 'undefined') ? initial_content : ''

		},view_part_id,instance_id)

	}

	/**
	 * @method save_object_coleccion
	 * @desc Crea o actualiza un objeto de tipo coleccion para un custom element determinado.
	 * @param {string} instance_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} info_new Configuración del nuevo objeto coleccion.
	 * @param {string} [id_object] Identificador del objeto en caso de que la acción requerida sea una actualización
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.save_object_coleccion = ( instance_id,view_part_id,info_new,id_object ) => {
		let actual_objects = cms_vtex_custom_elements.get_list_objects( 'coleccion',instance_id ),
			shelf_content_list = cms_vtex_custom_elements.generate_content_list_coleccion( actual_objects,instance_id,id_object )

		if(!id_object){
			shelf_content_list.push({
				ViewPartInstanceId : instance_id,
				Indice : actual_objects.length,
				ContentName : (info_new.ContentName) ? CMSVtex_general.get_html_entities(info_new.ContentName) : '',
				Partner : (info_new.partner) ? info_new.partner : '',
				Campaign : (info_new.campaign) ? info_new.campaign : '',
				Category : (info_new.category) ? info_new.category : '',
				Brand : (info_new.brand) ? info_new.brand : '',
				Source : (info_new.source) ? info_new.source : '',
				Keyword : (info_new.keyword) ? info_new.keyword : '',
				Periods : (info_new.periods) ? info_new.periods : [],
				Active : (info_new.active) ? 'True' : 'False',
				ProductCluster : (info_new.ProductCluster) ? info_new.ProductCluster : '',
				SearchQueryString : (info_new.SearchQueryString) ? info_new.SearchQueryString : ''
			})

			//delete actual_objects.objects;
			//actual_objects.totalRows = actual_objects_length + 1
			contentList = JSON.stringify(shelf_content_list)
			contentListInicial = ''

			let info_instance = cms_vtex_custom_elements.get_info_instance( instance_id,view_part_id,true );

			//console.log( 'info instance',info_instance )
					
			return cms_vtex_custom_elements.save('coleccion',{
				customViewPartName : info_instance.name,
				customViewPartTagName : info_instance.tag_name,
				layout : info_instance.layout,
				colCount : info_instance.colCount,
				itemCount : info_instance.itemCount,
				showUnavailable : info_instance.showUnavailable,
				isRandomize : info_instance.isRandomize,
				isPaged : info_instance.isPaged,
				contentList : contentList,
				contentListInicial : ''

			},view_part_id,instance_id)
		}
		else{
			//console.log(actual_objects.objects)
			let index_object_actual = actual_objects.map( (actual_object) => {
				return actual_object.id
			}).indexOf( id_object )
			
			if(index_object_actual === -1){
				return 'este objeto no existe, paila :\'(';
			}
			else{
				if(actual_objects[index_object_actual].additional.ProductCluster){
					default_productoCluster = actual_objects[index_object_actual].additional.ProductCluster.id
				}
				else{
					default_productoCluster = ''
				}
				//console.log('el index encontrado es',index_object_actual)
				shelf_content_list[index_object_actual] = {
					ViewPartInstanceId : instance_id,
					Indice : index_object_actual,
					ContentName : (info_new.ContentName) ? info_new.ContentName : CMSVtex_general.get_html_entities(actual_objects[index_object_actual].name),
					Partner : (info_new.partner) ? info_new.partner : actual_objects[index_object_actual].partner,
					Campaign : (info_new.campaign) ? info_new.campaign : actual_objects[index_object_actual].campaign,
					Category : (info_new.category) ? info_new.category : actual_objects[index_object_actual].category,
					Brand : (info_new.brand) ? info_new.brand : actual_objects[index_object_actual].brand,
					Source : (info_new.source) ? info_new.source : actual_objects[index_object_actual].source,
					Keyword : (info_new.keyword) ? info_new.keyword : actual_objects[index_object_actual].keyword,
					Periods : (info_new.periods) ? info_new.periods : actual_objects[index_object_actual].period,
					Active : (typeof info_new.active !== 'undefined') ? info_new.active : actual_objects[index_object_actual].active,
					ProductCluster : (info_new.ProductCluster) ? info_new.ProductCluster : default_productoCluster,
					SearchQueryString : (info_new.SearchQueryString) ? info_new.SearchQueryString : actual_objects[index_object_actual].additional.queryString,
					Id : actual_objects[index_object_actual].id
				}

				//console.log(shelf_content_list)

				//actual_objects.totalRows = actual_objects_length + 1
				//actual_objects.contentList = JSON.stringify(shelf_content_list)
				//actual_objects.contentListInicial = JSON.stringify(initial_content_list)

				//return cms_vtex_layout.save_config_coleccion( instance_id,actual_objects )

				let info_instance = cms_vtex_custom_elements.get_info_instance( instance_id,view_part_id,true );

				//console.log( 'info instance',info_instance )
						
				return cms_vtex_custom_elements.save('coleccion',{
					customViewPartName : info_instance.name,
					customViewPartTagName : info_instance.tag_name,
					layout : info_instance.layout,
					colCount : info_instance.colCount,
					itemCount : info_instance.itemCount,
					showUnavailable : info_instance.showUnavailable,
					isRandomize : info_instance.isRandomize,
					isPaged : info_instance.isPaged,
					contentList : JSON.stringify(shelf_content_list),
					contentListInicial : JSON.stringify(initial_content_list)

				},view_part_id,instance_id)
			}

		}

		//return cms_vtex_layout.get_list_objects( 'coleccion',instance_id );
		
		//return body
	}

	/**
	 * @method delete_object_html
	 * @desc Elimina un objeto del tipo html de un custom element determinado.
	 * @param {string} instance_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} id_object Identificador del objeto que se quiere eliminar.
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.delete_object_html = ( instance_id,view_part_id,id_object ) => {
		let actual_objects = cms_vtex_custom_elements.get_list_objects( 'html',instance_id ),
			html_content_list = [],
			initial_content_list = []

		indice = 0,
		indice2 = 0
		actual_objects.map( ( actual_object ) => {
			if(actual_object.id != id_object){
				html_content_list.push({
					ViewPartInstanceId : instance_id,
					Indice : indice,
					ContentName : actual_object.name,
					Partner : actual_object.partner,
					Campaign : actual_object.campaign,
					Category : actual_object.category,
					Brand : actual_object.brand,
					Source : actual_object.source,
					Keyword : actual_object.keyword,
					Periods : actual_object.period,
					Active : (actual_object.active) ? 'True' : 'False',
					FileName : '',
					Html : actual_object.additional,
					Id : actual_object.id
				})
				indice++
			}
			//else{
			initial_content_list.push({
				ViewPartInstanceId : instance_id,
				Indice : indice2,
				ContentName : actual_object.name,
				Partner : actual_object.partner,
				Campaign : actual_object.campaign,
				Category : actual_object.category,
				Brand : actual_object.brand,
				Source : actual_object.source,
				Keyword : actual_object.keyword,
				Periods : actual_object.period,
				Active : (actual_object.active) ? 'True' : 'False',
				FileName : '',
				Html : actual_object.additional,
				Id : actual_object.id
			})
			//}

			indice2++
		})

		let info_instance = cms_vtex_custom_elements.get_info_instance( instance_id,view_part_id );
		
		return cms_vtex_custom_elements.save('html',{
			customViewPartName : info_instance.name,
			customViewPartTagName : info_instance.tag_name,
			htmlContentList : html_content_list,
			htmlContentListInicial : initial_content_list
		},view_part_id,instance_id)
	}

	/**
	 * @method delete_object_coleccion
	 * @desc Elimina un objeto del tipo coleccion de un custom element determinado.
	 * @param {string} instance_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} view_part_id Identificador devuelto por Vtex y otros métodos de este módulo.
	 * @param {string} id_object Identificador del objeto que se quiere eliminar.
	 * @return {string|Boolean} Devuelve true si Vtex no retornó ningún error de lo contrario retorna un string con el mensaje d error generado por Vtex
	 */
	cms_vtex_custom_elements.delete_object_coleccion = ( instance_id,view_part_id,id_object ) => {
		let actual_objects = cms_vtex_custom_elements.get_list_objects( 'coleccion',instance_id );
		console.log(actual_objects)
		let index_object = actual_objects.map( ( actual_object ) => {
			return actual_object.id;
		}).indexOf( id_object );

		if(index_object === -1){
			return 'Este objeto no existe, al menos no en esta instancia (?)';
		}
		else{
			let contentList = actual_objects
			let contentListInicial = actual_objects.slice()
			contentList.splice( index_object,1 );
			console.log(contentList,contentListInicial)

			let info_instance = cms_vtex_custom_elements.get_info_instance( instance_id,view_part_id,true );
			return cms_vtex_custom_elements.save('coleccion',{
				customViewPartName : info_instance.name,
				customViewPartTagName : info_instance.tag_name,
				layout : info_instance.layout,
				colCount : info_instance.colCount,
				itemCount : info_instance.itemCount,
				showUnavailable : info_instance.showUnavailable,
				isRandomize : info_instance.isRandomize,
				isPaged : info_instance.isPaged,
				contentList : JSON.stringify(contentList),
				contentListInicial : JSON.stringify(contentListInicial)

			},view_part_id,instance_id)
			//return cms_vtex_layout.save_config_coleccion( instance_id,actual_objects,true,true )
		}
	}

	return cms_vtex_custom_elements;
}</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.1</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
